# システム設計書 - トランスクリプト議事録生成システム

## 1. 文書情報

| 項目 | 内容 |
|------|------|
| 文書名 | システム設計書 |
| バージョン | 1.0 |
| 作成日 | 2025年7月24日 |
| 作成者 | AI Assistant |
| 基準文書 | 実装計画書01.md, 設計書作成計画書.md |

## 2. システム概要

### 2.1 システム目的
Azure OpenAIを活用してトランスクリプトから構造化された議事録を自動生成するWebAPIシステムです。

### 2.2 主要機能
- **トランスクリプト処理**: テキスト形式のトランスクリプトを受信・解析
- **AI議事録生成**: Azure OpenAI GPT-4による高品質な議事録作成
- **RESTful API**: 標準的なHTTP APIによるサービス提供
- **ログ管理**: 包括的な操作ログとエラートラッキング

### 2.3 技術的特徴
- **型安全性**: Pydantic V2による厳密なデータバリデーション
- **非同期処理**: FastAPIによる高性能な非同期API
- **設定管理**: 環境変数による柔軟な設定管理
- **拡張性**: モジュラー設計による将来機能拡張対応

## 3. システムアーキテクチャ

### 3.1 全体構成図

```
┌─────────────────────────────────────────────────────────────┐
│                    クライアント層                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │
│  │ Webアプリ    │  │ モバイルアプリ │  │ 外部システム │      │
│  └─────────────┘  └─────────────┘  └─────────────┘      │
└─────────────────────────────────────────────────────────────┘
                              │
                         HTTPS/REST API
                              │
┌─────────────────────────────────────────────────────────────┐
│                     API Gateway層                           │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │              FastAPI Application                        │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │ │
│  │  │ Auth Router │  │Minutes Router│  │Health Router│   │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘   │ │
│  └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
                              │
                         Internal API
                              │
┌─────────────────────────────────────────────────────────────┐
│                    ビジネスロジック層                          │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │                   Core Modules                          │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │ │
│  │  │Transcript   │  │Azure OpenAI │  │   Logger    │   │ │
│  │  │Processor    │  │   Client    │  │   Module    │   │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘   │ │
│  └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
                              │
                         API Calls
                              │
┌─────────────────────────────────────────────────────────────┐
│                     外部サービス層                            │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │                Azure OpenAI Service                     │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │ │
│  │  │   GPT-4     │  │  Embedding  │  │  Completion │   │ │
│  │  │   Model     │  │   Service   │  │   Service   │   │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘   │ │
│  └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 レイヤー構成

#### 3.2.1 プレゼンテーション層 (Presentation Layer)
- **責務**: HTTP リクエスト/レスポンス処理、入力検証、認証
- **コンポーネント**: FastAPI ルーター、Pydantic スキーマ
- **技術**: FastAPI, Pydantic V2, OAuth2

#### 3.2.2 ビジネスロジック層 (Business Logic Layer)
- **責務**: 業務ロジック実装、データ変換、外部API連携
- **コンポーネント**: プロセッサー、クライアント、ユーティリティ
- **技術**: Python async/await, Azure OpenAI SDK

#### 3.2.3 インフラストラクチャ層 (Infrastructure Layer)
- **責務**: 外部サービス連携、ログ管理、設定管理
- **コンポーネント**: Azure OpenAI クライアント、ログ設定
- **技術**: Azure OpenAI API, Python logging

### 3.3 コンポーネント図

```
┌─────────────────────────────────────────────────────────────┐
│                      main.py                                │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │                FastAPI Application                      │ │
│  │                                                         │ │
│  │  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐ │ │
│  │  │   Router    │    │   Router    │    │   Router    │ │ │
│  │  │  /minutes   │    │   /health   │    │    /docs    │ │ │
│  │  └─────────────┘    └─────────────┘    └─────────────┘ │ │
│  └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                   src/routers/minutes.py                    │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │                 Minutes Router                          │ │
│  │                                                         │ │
│  │  POST /minutes/generate  ──────────────────────────────┐│ │
│  │  GET  /minutes/health    ──────────────────────────────┘│ │
│  └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│              src/modules/transcript_processor.py            │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │               TranscriptProcessor                       │ │
│  │                                                         │ │
│  │  + process_transcript(request) -> MinutesResponse       │ │
│  │  - _validate_input(content)                             │ │
│  │  - _generate_minutes(content)                           │ │
│  └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│             src/modules/azure_openai_client.py              │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │               AzureOpenAIClient                         │ │
│  │                                                         │ │
│  │  + generate_minutes(transcript) -> str                  │ │
│  │  - _create_prompt(transcript)                           │ │
│  │  - _call_api(messages)                                  │ │
│  └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

## 4. 技術アーキテクチャ

### 4.1 技術スタック

| レイヤー | 技術 | バージョン | 用途 |
|---------|------|-----------|------|
| Web Framework | FastAPI | 0.104.1 | REST API フレームワーク |
| ASGI Server | Uvicorn | 0.24.0 | 非同期Webサーバー |
| Data Validation | Pydantic | 2.5.0 | データバリデーション・シリアライゼーション |
| Settings Management | pydantic-settings | 2.1.0 | 環境変数管理 |
| AI Service | Azure OpenAI | 1.3.7 | AI議事録生成エンジン |
| HTTP Client | httpx | - | 非同期HTTPクライアント |
| Logging | Python logging | 標準ライブラリ | ログ管理 |

### 4.2 フレームワーク選定理由

#### 4.2.1 FastAPI
- **高性能**: Starlette ベースの高速な非同期処理
- **型安全**: Python 型ヒントによる自動バリデーション
- **自動ドキュメント**: OpenAPI/Swagger による自動API文書生成
- **開発効率**: 直感的なAPI設計と豊富な機能

#### 4.2.2 Pydantic V2
- **データバリデーション**: 厳密な型チェックとエラーハンドリング
- **シリアライゼーション**: JSON ↔ Python オブジェクト変換
- **設定管理**: 環境変数の型安全な管理
- **パフォーマンス**: Rust ベースの高速処理

#### 4.2.3 Azure OpenAI
- **企業向け**: エンタープライズグレードのセキュリティ
- **高品質**: GPT-4 による高精度な議事録生成
- **スケーラビリティ**: Azure インフラによる安定性
- **コンプライアンス**: データ保護とプライバシー対応

### 4.3 アーキテクチャパターン

#### 4.3.1 レイヤードアーキテクチャ
- **分離の原則**: 各レイヤーの責務を明確に分離
- **依存関係**: 上位レイヤーから下位レイヤーへの単方向依存
- **テスタビリティ**: レイヤー単位でのユニットテスト実装

#### 4.3.2 依存性注入 (Dependency Injection)
- **疎結合**: コンポーネント間の依存関係を最小化
- **テスト容易性**: モックオブジェクトによるテスト実装
- **設定管理**: 環境に応じた設定の動的注入

#### 4.3.3 非同期処理パターン
- **async/await**: Python 非同期処理による高性能化
- **コルーチン**: I/O バウンドな処理の効率化
- **並行処理**: 複数リクエストの同時処理

## 5. 外部連携

### 5.1 Azure OpenAI API連携

#### 5.1.1 認証方式
- **API Key認証**: Azure OpenAI サービスキーによる認証
- **エンドポイント**: カスタムAzureエンドポイント使用
- **バージョン管理**: API バージョン指定による安定性確保

#### 5.1.2 API呼び出しフロー
```
1. クライアント → FastAPI: トランスクリプト送信
2. FastAPI → TranscriptProcessor: リクエスト処理
3. TranscriptProcessor → AzureOpenAIClient: AI処理依頼
4. AzureOpenAIClient → Azure OpenAI: API呼び出し
5. Azure OpenAI → AzureOpenAIClient: 議事録レスポンス
6. AzureOpenAIClient → TranscriptProcessor: 結果返却
7. TranscriptProcessor → FastAPI: 構造化レスポンス
8. FastAPI → クライアント: JSON レスポンス
```

#### 5.1.3 エラーハンドリング
- **リトライ機能**: 一時的な障害に対する自動再試行
- **タイムアウト**: 適切なタイムアウト設定
- **フォールバック**: サービス障害時の代替処理

### 5.2 将来の外部連携（拡張予定）

#### 5.2.1 Microsoft Graph SDK
- **Teams連携**: Teams会議からの自動トランスクリプト取得
- **認証**: OAuth2.0 による安全な認証
- **データ同期**: リアルタイムでの会議データ取得

#### 5.2.2 データベース連携
- **永続化**: 議事録データの永続的保存
- **履歴管理**: 議事録の版数管理と履歴追跡
- **検索機能**: 全文検索による議事録検索

## 6. 非機能要件

### 6.1 パフォーマンス要件

| 項目 | 要件 | 測定方法 |
|------|------|----------|
| レスポンス時間 | 95%のリクエストが5秒以内 | APM ツールによる監視 |
| スループット | 100 req/sec 以上 | 負荷テストによる測定 |
| 同時接続数 | 1000 接続以上 | 負荷テストによる測定 |
| CPU使用率 | 平均70%以下 | システム監視ツール |
| メモリ使用率 | 平均80%以下 | システム監視ツール |

### 6.2 可用性要件

| 項目 | 要件 | 対策 |
|------|------|------|
| 稼働率 | 99.9% 以上 | 冗長化、監視、自動復旧 |
| 復旧時間 | 5分以内 | 自動フェイルオーバー |
| データ損失 | ゼロ | バックアップ、レプリケーション |

### 6.3 セキュリティ要件

| 項目 | 要件 | 実装方法 |
|------|------|----------|
| 通信暗号化 | TLS 1.3 以上 | HTTPS 強制 |
| 認証 | JWT トークン認証 | OAuth2.0 準拠 |
| 認可 | ロールベースアクセス制御 | RBAC 実装 |
| 入力検証 | 全入力データの検証 | Pydantic バリデーション |
| ログ監査 | 全操作のログ記録 | 構造化ログ |

### 6.4 拡張性要件

| 項目 | 要件 | 設計方針 |
|------|------|----------|
| 水平スケーリング | ロードバランサー対応 | ステートレス設計 |
| 垂直スケーリング | リソース増強対応 | 非同期処理 |
| 機能拡張 | プラグイン機能 | モジュラー設計 |
| API バージョニング | 後方互換性維持 | バージョン管理 |

## 7. 制約事項・前提条件

### 7.1 技術的制約

#### 7.1.1 Azure OpenAI制約
- **レート制限**: API呼び出し回数制限（分/時間単位）
- **トークン制限**: 入力・出力トークン数の上限
- **地域制限**: 利用可能なAzureリージョンの制限
- **モデル制限**: 利用可能なGPTモデルの制限

#### 7.1.2 システム制約
- **Python バージョン**: Python 3.12 以上
- **メモリ制限**: 最小 2GB RAM
- **ストレージ**: 最小 10GB 空き容量
- **ネットワーク**: インターネット接続必須

### 7.2 運用制約

#### 7.2.1 データ制約
- **トランスクリプト長**: 最大 100,000 文字
- **ファイルサイズ**: 最大 10MB
- **同時処理**: 最大 100 リクエスト
- **保存期間**: ログ 30日間保持

#### 7.2.2 セキュリティ制約
- **API キー管理**: 定期的なローテーション必須
- **アクセスログ**: 全アクセスの記録必須
- **データ暗号化**: 保存時・転送時暗号化必須
- **監査**: 定期的なセキュリティ監査実施

### 7.3 前提条件

#### 7.3.1 環境前提
- **Azure OpenAI**: サービス契約済み
- **API キー**: 有効なAPIキー取得済み
- **ネットワーク**: Azure OpenAI への接続可能
- **権限**: 必要な Azure リソースへのアクセス権

#### 7.3.2 運用前提
- **監視体制**: 24/7 監視体制構築
- **サポート体制**: 技術サポート体制確立
- **バックアップ**: 定期バックアップ運用
- **災害復旧**: DR サイト準備

## 8. 今後の拡張計画

### 8.1 Phase 2: 認証・データベース統合
- **JWT認証**: ユーザー認証機能の実装
- **データベース**: SQLAlchemy による永続化
- **ユーザー管理**: ユーザー登録・管理機能
- **履歴管理**: 議事録履歴の保存・検索

### 8.2 Phase 3: Microsoft Graph統合
- **Teams連携**: Teams会議との自動連携
- **カレンダー統合**: 会議スケジュールとの連携
- **ファイル共有**: SharePoint との連携
- **通知機能**: Teams 通知機能

### 8.3 Phase 4: 高度な機能
- **テンプレート**: カスタマイズ可能な議事録テンプレート
- **多言語対応**: 複数言語での議事録生成
- **音声認識**: 音声ファイルからの直接変換
- **AI分析**: 議事録の感情分析・要約機能

### 8.4 Phase 5: エンタープライズ機能
- **マルチテナント**: 複数組織対応
- **SAML/SSO**: エンタープライズ認証連携
- **監査ログ**: 詳細な監査ログ機能
- **コンプライアンス**: 各種規制対応

---

**文書管理情報**
- **最終更新**: 2025年7月24日
- **レビュー状況**: 初版作成完了
- **承認者**: 未定
- **次回レビュー**: 実装完了後

# FastAPI Azure OpenAI 議事録生成システム 実装計画書01

## 1. プロジェクト概要

### 1.1 目的
トランスクリプトから議事録を自動生成するFastAPIベースのWebAPIシステムを構築する。
Azure OpenAIを活用してAI処理を行い、高品質な議事録を生成する。

### 1.2 主要機能
- トランスクリプトデータの受信・処理
- Azure OpenAI APIを使用した議事録生成
- 構造化された議事録の出力
- 包括的なログ機能
- 環境変数による設定管理

## 2. システム構成

### 2.1 ディレクトリ構造
```
/
├── modules/           # ビジネスロジック・処理モジュール
│   ├── config.py     # 設定管理（BaseSettings）
│   ├── azure_openai_client.py  # Azure OpenAI クライアント
│   ├── minutes_generator.py    # 議事録生成ロジック
│   └── logger_config.py        # ログ設定
├── routers/          # FastAPI ルーター（エンドポイント定義）
├── schemas/          # Pydantic データモデル
├── env/              # 環境設定ディレクトリ
│   ├── .env         # 環境変数設定ファイル（機密情報含む）
│   └── .env.example # 環境変数テンプレートファイル（機密情報除く）
├── main.py          # FastAPI アプリケーションエントリーポイント
├── requirements.txt # 依存関係
└── README.md        # プロジェクト説明
```

### 2.2 技術スタック
- **フレームワーク**: FastAPI
- **AI処理**: Azure OpenAI
- **データ検証**: Pydantic
- **ログ**: Python標準logging
- **環境管理**: python-dotenv

## 3. 環境設定

### 3.1 env/.env ファイル構成
```env
azure_openai_api_key=your_azure_openai_api_key_here
azure_openai_model=gpt-4
azure_openai_version=2024-02-15-preview
azure_openai_endpoint=https://your-resource.openai.azure.com/
```

### 3.2 env/.env.example ファイル構成
```env
# Azure OpenAI API設定
azure_openai_api_key=your_azure_openai_api_key_here
azure_openai_model=gpt-4
azure_openai_version=2024-02-15-preview
azure_openai_endpoint=https://your-resource.openai.azure.com/
```

### 3.3 環境変数仕様
- **azure_openai_api_key**: Azure OpenAI APIキー（文字列）
- **azure_openai_model**: 使用するモデル名（文字列）
- **azure_openai_version**: APIバージョン（文字列）
- **azure_openai_endpoint**: Azure OpenAIエンドポイントURL（文字列）

## 4. モジュール設計

### 4.1 schemas/ - データモデル

#### 4.1.1 transcript.py
```python
from pydantic import BaseModel
from typing import List
from datetime import datetime

class TranscriptInput(BaseModel):
    meeting_title: str
    meeting_date: datetime
    participants: List[str]
    transcript_text: str
```

#### 4.1.2 minutes.py
```python
from pydantic import BaseModel
from typing import List, Optional
from datetime import datetime

class ActionItem(BaseModel):
    task: str
    assignee: str
    due_date: Optional[str] = None

class MinutesOutput(BaseModel):
    meeting_title: str
    meeting_date: datetime
    participants: List[str]
    summary: str
    key_points: List[str]
    decisions: List[str]
    action_items: List[ActionItem]
    next_meeting: Optional[str] = None
```

### 4.2 modules/ - ビジネスロジック

#### 4.2.1 config.py
```python
from pydantic_settings import BaseSettings
from typing import Optional

class Settings(BaseSettings):
    azure_openai_api_key: str
    azure_openai_model: str
    azure_openai_version: str
    azure_openai_endpoint: str
    
    class Config:
        env_file = "env/.env"

settings = Settings()
```

#### 4.2.2 azure_openai_client.py
```python
from openai import AzureOpenAI
import logging
from typing import Optional

class AzureOpenAIClient:
    def __init__(self, 
                 azure_openai_api_key: str,
                 azure_openai_endpoint: str, 
                 azure_openai_model: str,
                 azure_openai_version: str):
        self.azure_openai_api_key = azure_openai_api_key
        self.azure_openai_endpoint = azure_openai_endpoint
        self.azure_openai_model = azure_openai_model
        self.azure_openai_version = azure_openai_version
        
        # 必須パラメータの検証
        if not all([self.azure_openai_api_key, self.azure_openai_endpoint, self.azure_openai_model, self.azure_openai_version]):
            raise ValueError("Missing required Azure OpenAI configuration parameters")
        
        self.client = AzureOpenAI(
            api_key=self.azure_openai_api_key,
            api_version=self.azure_openai_version,
            azure_endpoint=self.azure_openai_endpoint
        )
        
    def generate_minutes(self, prompt: str) -> str:
        # Azure OpenAI API呼び出し処理
        pass
```

#### 4.2.3 minutes_generator.py
```python
from .azure_openai_client import AzureOpenAIClient
from .config import settings
from schemas.transcript import TranscriptInput
from schemas.minutes import MinutesOutput
import logging

class MinutesGenerator:
    def __init__(self):
        # 設定値を引数として渡してクライアントを初期化
        self.azure_client = AzureOpenAIClient(
            azure_openai_api_key=settings.azure_openai_api_key,
            azure_openai_endpoint=settings.azure_openai_endpoint,
            azure_openai_model=settings.azure_openai_model,
            azure_openai_version=settings.azure_openai_version
        )
        
    def generate_minutes(self, transcript_data: TranscriptInput) -> MinutesOutput:
        # 議事録生成処理
        pass
        
    def create_prompt(self, transcript_data: TranscriptInput) -> str:
        # プロンプト作成処理
        pass
```

#### 4.2.4 logger_config.py
```python
import logging
import sys

def setup_logger():
    logging.basicConfig(
        level=logging.INFO,
        format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
        handlers=[
            logging.FileHandler('app.log'),
            logging.StreamHandler(sys.stdout)
        ]
    )
    return logging.getLogger(__name__)
```

### 4.3 routers/ - API エンドポイント

#### 4.3.1 minutes.py
```python
from fastapi import APIRouter, HTTPException
from schemas.transcript import TranscriptInput
from schemas.minutes import MinutesOutput
from modules.minutes_generator import MinutesGenerator
import logging

router = APIRouter(prefix="/api/v1/minutes", tags=["minutes"])
logger = logging.getLogger(__name__)

@router.post("/generate", response_model=MinutesOutput)
async def generate_meeting_minutes(transcript_data: TranscriptInput):
    # 議事録生成エンドポイント処理
    pass
```

## 5. 実装手順

### 5.1 フェーズ1: 基盤構築
1. ディレクトリ構造作成（env/フォルダ含む）
2. 依存関係ファイル作成（requirements.txt）
3. env/.env ファイル作成
4. env/.env.example ファイル作成（機密情報除去版）
5. main.py 作成（FastAPI アプリケーション初期化）

### 5.2 フェーズ2: 設定管理実装
1. modules/config.py 実装（BaseSettings使用）
2. 環境変数読み込みテスト
3. 設定値検証機能実装

### 5.3 フェーズ3: データモデル実装
1. schemas/transcript.py 実装
2. schemas/minutes.py 実装
3. データ検証テスト

### 5.4 フェーズ4: Azure OpenAI 統合
1. modules/azure_openai_client.py 実装（引数渡し方式）
2. Azure OpenAI 接続テスト
3. API呼び出し機能実装

### 5.5 フェーズ5: ビジネスロジック実装
1. modules/minutes_generator.py 実装（設定値注入方式）
2. プロンプト設計・実装
3. 議事録生成ロジック実装

### 5.6 フェーズ6: API エンドポイント実装
1. routers/minutes.py 実装
2. エラーハンドリング実装
3. ログ機能統合

### 5.7 フェーズ7: テスト・検証
1. 単体テスト実装（モック注入テスト含む）
2. 統合テスト実行
3. パフォーマンステスト

## 6. セキュリティ考慮事項

### 6.1 API キー管理
- env/.env ファイルを .gitignore に追加
- env/.env.example ファイルで第三者向けテンプレート提供
- 環境変数による機密情報管理
- 本番環境での適切なシークレット管理

### 6.2 入力検証
- Pydantic による厳密なデータ検証
- SQLインジェクション対策（該当する場合）
- XSS対策（該当する場合）

## 7. ログ戦略

### 7.1 ログレベル
- **INFO**: 正常な処理フロー
- **WARNING**: 注意が必要な状況
- **ERROR**: エラー発生時
- **DEBUG**: デバッグ情報（開発時のみ）

### 7.2 ログ出力項目
- タイムスタンプ
- ログレベル
- モジュール名
- メッセージ内容
- リクエストID（トレーサビリティ向上）

## 8. エラーハンドリング

### 8.1 Azure OpenAI API エラー
- 認証エラー
- レート制限エラー
- タイムアウトエラー
- サービス利用不可エラー

### 8.2 アプリケーションエラー
- 入力データ検証エラー
- 内部処理エラー
- 設定エラー

## 9. パフォーマンス考慮事項

### 9.1 最適化ポイント
- Azure OpenAI API呼び出しの最適化
- 大容量トランスクリプト処理
- レスポンス時間の監視
- メモリ使用量の最適化

### 9.2 監視項目
- API レスポンス時間
- エラー率
- スループット
- リソース使用率

## 10. デプロイメント

### 10.1 本番環境要件
- Python 3.8+
- 必要な依存関係のインストール
- 環境変数の適切な設定
- ログファイルの管理

### 10.2 起動コマンド
```bash
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

## 11. 設計上の利点

### 11.1 BaseSettings + 引数渡し方式の利点
- **テスタビリティ向上**: モックオブジェクトの注入が容易
- **依存関係の明確化**: 必要な設定値が明示的
- **型安全性**: Pydanticによる型チェックと検証
- **設定の一元管理**: config.pyで設定値を集約
- **柔軟性**: 異なる設定での複数インスタンス作成可能

### 11.2 保守性の向上
- **単一責任原則**: 各クラスが明確な責任を持つ
- **依存関係注入**: テスト時の設定変更が容易
- **設定値の検証**: BaseSettingsによる自動検証
- **エラーハンドリング**: 設定不備の早期発見
- **セキュリティ向上**: env/.env.exampleで機密情報を分離

## 12. 今後の拡張予定

### 12.1 機能拡張
- 複数言語対応
- 議事録テンプレートのカスタマイズ
- ファイルアップロード機能
- 議事録の保存・管理機能

### 12.2 技術的改善
- 非同期処理の最適化
- キャッシュ機能の追加
- データベース統合
- 認証・認可機能

---

**作成日**: 2025年7月14日  
**作成者**: Devin AI  
**バージョン**: 1.1（BaseSettings + 引数渡し方式対応）  
**対象ブランチ**: main_okawa_20250714

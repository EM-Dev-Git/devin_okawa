# FastAPI Azure OpenAI 議事録生成システム 実装計画書01

## 1. プロジェクト概要

### 1.1 目的
トランスクリプトから議事録を自動生成するFastAPIベースのWebAPIシステムを構築する。
Azure OpenAIを活用してAI処理を行い、高品質な議事録を生成する。

### 1.2 主要機能
- トランスクリプトデータの受信・処理
- Azure OpenAI APIを使用した議事録生成
- 構造化された議事録の出力
- 包括的なログ機能
- 環境変数による設定管理

## 2. システム構成

### 2.1 ディレクトリ構造
```
/
├── modules/           # ビジネスロジック・処理モジュール
├── routers/          # FastAPI ルーター（エンドポイント定義）
├── schemas/          # Pydantic データモデル
├── .env             # 環境変数設定ファイル
├── main.py          # FastAPI アプリケーションエントリーポイント
├── requirements.txt # 依存関係
└── README.md        # プロジェクト説明
```

### 2.2 技術スタック
- **フレームワーク**: FastAPI
- **AI処理**: Azure OpenAI
- **データ検証**: Pydantic
- **ログ**: Python標準logging
- **環境管理**: python-dotenv

## 3. 環境設定

### 3.1 .env ファイル構成
```env
azure_openai_api_key=your_azure_openai_api_key_here
azure_openai_model=gpt-4
azure_openai_version=2024-02-15-preview
azure_openai_endpoint=https://your-resource.openai.azure.com/
```

### 3.2 環境変数仕様
- **azure_openai_api_key**: Azure OpenAI APIキー（文字列）
- **azure_openai_model**: 使用するモデル名（文字列）
- **azure_openai_version**: APIバージョン（文字列）
- **azure_openai_endpoint**: Azure OpenAIエンドポイントURL（文字列）

## 4. モジュール設計

### 4.1 schemas/ - データモデル

#### 4.1.1 transcript.py
```python
from pydantic import BaseModel
from typing import List
from datetime import datetime

class TranscriptInput(BaseModel):
    meeting_title: str
    meeting_date: datetime
    participants: List[str]
    transcript_text: str
```

#### 4.1.2 minutes.py
```python
from pydantic import BaseModel
from typing import List, Optional
from datetime import datetime

class ActionItem(BaseModel):
    task: str
    assignee: str
    due_date: Optional[str] = None

class MinutesOutput(BaseModel):
    meeting_title: str
    meeting_date: datetime
    participants: List[str]
    summary: str
    key_points: List[str]
    decisions: List[str]
    action_items: List[ActionItem]
    next_meeting: Optional[str] = None
```

### 4.2 modules/ - ビジネスロジック

#### 4.2.1 azure_openai_client.py
```python
from openai import AzureOpenAI
import logging
import os
from dotenv import load_dotenv

class AzureOpenAIClient:
    def __init__(self):
        load_dotenv()
        self.api_key = os.getenv("azure_openai_api_key")
        self.model = os.getenv("azure_openai_model")
        self.api_version = os.getenv("azure_openai_version")
        self.endpoint = os.getenv("azure_openai_endpoint")
        
        self.client = AzureOpenAI(
            api_key=self.api_key,
            api_version=self.api_version,
            azure_endpoint=self.endpoint
        )
        
    def generate_minutes(self, prompt: str) -> str:
        # Azure OpenAI API呼び出し処理
        pass
```

#### 4.2.2 minutes_generator.py
```python
from .azure_openai_client import AzureOpenAIClient
from schemas.transcript import TranscriptInput
from schemas.minutes import MinutesOutput
import logging

class MinutesGenerator:
    def __init__(self):
        self.azure_client = AzureOpenAIClient()
        
    def generate_minutes(self, transcript_data: TranscriptInput) -> MinutesOutput:
        # 議事録生成処理
        pass
        
    def create_prompt(self, transcript_data: TranscriptInput) -> str:
        # プロンプト作成処理
        pass
```

#### 4.2.3 logger_config.py
```python
import logging
import sys

def setup_logger():
    logging.basicConfig(
        level=logging.INFO,
        format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
        handlers=[
            logging.FileHandler('app.log'),
            logging.StreamHandler(sys.stdout)
        ]
    )
    return logging.getLogger(__name__)
```

### 4.3 routers/ - API エンドポイント

#### 4.3.1 minutes.py
```python
from fastapi import APIRouter, HTTPException
from schemas.transcript import TranscriptInput
from schemas.minutes import MinutesOutput
from modules.minutes_generator import MinutesGenerator
import logging

router = APIRouter(prefix="/api/v1/minutes", tags=["minutes"])
logger = logging.getLogger(__name__)

@router.post("/generate", response_model=MinutesOutput)
async def generate_meeting_minutes(transcript_data: TranscriptInput):
    # 議事録生成エンドポイント処理
    pass
```

## 5. 実装手順

### 5.1 フェーズ1: 基盤構築
1. ディレクトリ構造作成
2. 依存関係ファイル作成（requirements.txt）
3. .env ファイル作成
4. main.py 作成（FastAPI アプリケーション初期化）

### 5.2 フェーズ2: データモデル実装
1. schemas/transcript.py 実装
2. schemas/minutes.py 実装
3. データ検証テスト

### 5.3 フェーズ3: Azure OpenAI 統合
1. modules/azure_openai_client.py 実装
2. Azure OpenAI 接続テスト
3. API呼び出し機能実装

### 5.4 フェーズ4: ビジネスロジック実装
1. modules/minutes_generator.py 実装
2. プロンプト設計・実装
3. 議事録生成ロジック実装

### 5.5 フェーズ5: API エンドポイント実装
1. routers/minutes.py 実装
2. エラーハンドリング実装
3. ログ機能統合

### 5.6 フェーズ6: テスト・検証
1. 単体テスト実装
2. 統合テスト実行
3. パフォーマンステスト

## 6. セキュリティ考慮事項

### 6.1 API キー管理
- .env ファイルを .gitignore に追加
- 環境変数による機密情報管理
- 本番環境での適切なシークレット管理

### 6.2 入力検証
- Pydantic による厳密なデータ検証
- SQLインジェクション対策（該当する場合）
- XSS対策（該当する場合）

## 7. ログ戦略

### 7.1 ログレベル
- **INFO**: 正常な処理フロー
- **WARNING**: 注意が必要な状況
- **ERROR**: エラー発生時
- **DEBUG**: デバッグ情報（開発時のみ）

### 7.2 ログ出力項目
- タイムスタンプ
- ログレベル
- モジュール名
- メッセージ内容
- リクエストID（トレーサビリティ向上）

## 8. エラーハンドリング

### 8.1 Azure OpenAI API エラー
- 認証エラー
- レート制限エラー
- タイムアウトエラー
- サービス利用不可エラー

### 8.2 アプリケーションエラー
- 入力データ検証エラー
- 内部処理エラー
- 設定エラー

## 9. パフォーマンス考慮事項

### 9.1 最適化ポイント
- Azure OpenAI API呼び出しの最適化
- 大容量トランスクリプト処理
- レスポンス時間の監視
- メモリ使用量の最適化

### 9.2 監視項目
- API レスポンス時間
- エラー率
- スループット
- リソース使用率

## 10. デプロイメント

### 10.1 本番環境要件
- Python 3.8+
- 必要な依存関係のインストール
- 環境変数の適切な設定
- ログファイルの管理

### 10.2 起動コマンド
```bash
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

## 11. 今後の拡張予定

### 11.1 機能拡張
- 複数言語対応
- 議事録テンプレートのカスタマイズ
- ファイルアップロード機能
- 議事録の保存・管理機能

### 11.2 技術的改善
- 非同期処理の最適化
- キャッシュ機能の追加
- データベース統合
- 認証・認可機能

---

**作成日**: 2025年7月14日  
**作成者**: Devin AI  
**バージョン**: 1.0  
**対象ブランチ**: main_okawa_20250714

# 会議トランスクリプトから議事録生成API 実装計画書01

## 1. プロジェクト概要

### 1.1 目的
会議のトランスクリプト（文字起こし）を入力として受け取り、OpenAI APIを使用して構造化された議事録を自動生成するFastAPI アプリケーションを構築する。

### 1.2 主要機能
- トランスクリプトテキストの受信・処理
- OpenAI APIを使用した議事録の自動生成
- 構造化された議事録フォーマットでの出力
- ログ機能による処理状況の記録
- 環境変数による設定管理

## 2. 技術仕様

### 2.1 フレームワーク・ライブラリ
- **FastAPI**: Web APIフレームワーク（公式サイト準拠）
- **OpenAI Python SDK**: OpenAI API接続用
- **Pydantic**: データバリデーション・シリアライゼーション
- **Python Logging**: ログ機能
- **python-dotenv**: 環境変数管理

### 2.2 Python バージョン
- Python 3.8以上（FastAPI要件に準拠）

## 3. ディレクトリ構成

```
project_root/
├── main.py                 # FastAPIアプリケーションエントリーポイント
├── config.py              # 設定管理
├── .env                   # 環境変数ファイル
├── .env.example           # 環境変数テンプレート
├── requirements.txt       # 依存関係
├── modules/               # ビジネスロジック層
│   ├── __init__.py
│   ├── transcript_processor.py    # トランスクリプト処理
│   ├── openai_client.py          # OpenAI API クライアント
│   └── minutes_generator.py      # 議事録生成ロジック
├── routers/               # APIルーティング層
│   ├── __init__.py
│   ├── health.py          # ヘルスチェック
│   └── minutes.py         # 議事録生成エンドポイント
└── schemas/               # データモデル定義
    ├── __init__.py
    ├── transcript.py      # トランスクリプト入力スキーマ
    ├── minutes.py         # 議事録出力スキーマ
    └── common.py          # 共通スキーマ
```

## 4. 詳細設計

### 4.1 環境変数設計 (.env)

```bash
# OpenAI API設定
OPENAI_API_KEY=your_openai_api_key_here
OPENAI_MODEL=gpt-4o
OPENAI_MAX_TOKENS=2000
OPENAI_TEMPERATURE=0.7

# アプリケーション設定
APP_NAME=Meeting Minutes Generator
APP_VERSION=1.0.0
DEBUG=True
LOG_LEVEL=INFO

# サーバー設定
HOST=0.0.0.0
PORT=8000
```

### 4.2 設定管理 (config.py)

```python
from pydantic_settings import BaseSettings
from typing import Optional

class Settings(BaseSettings):
    # OpenAI設定
    openai_api_key: str
    openai_model: str = "gpt-4o"
    openai_max_tokens: int = 2000
    openai_temperature: float = 0.7
    
    # アプリケーション設定
    app_name: str = "Meeting Minutes Generator"
    app_version: str = "1.0.0"
    debug: bool = False
    log_level: str = "INFO"
    
    # サーバー設定
    host: str = "0.0.0.0"
    port: int = 8000
    
    class Config:
        env_file = ".env"

settings = Settings()
```

### 4.3 データスキーマ設計

#### 4.3.1 入力スキーマ (schemas/transcript.py)

```python
from pydantic import BaseModel, Field
from typing import Optional
from datetime import datetime

class TranscriptInput(BaseModel):
    """トランスクリプト入力データモデル"""
    
    meeting_title: str = Field(..., description="会議タイトル")
    meeting_date: datetime = Field(..., description="会議日時")
    participants: list[str] = Field(..., description="参加者リスト")
    transcript_text: str = Field(..., min_length=10, description="会議トランスクリプト")
    meeting_duration: Optional[int] = Field(None, description="会議時間（分）")
    
    class Config:
        json_schema_extra = {
            "example": {
                "meeting_title": "週次進捗会議",
                "meeting_date": "2025-01-11T09:00:00",
                "participants": ["田中", "佐藤", "鈴木"],
                "transcript_text": "おはようございます。今週の進捗について...",
                "meeting_duration": 30
            }
        }
```

#### 4.3.2 出力スキーマ (schemas/minutes.py)

```python
from pydantic import BaseModel, Field
from typing import List, Optional
from datetime import datetime

class ActionItem(BaseModel):
    """アクションアイテム"""
    task: str = Field(..., description="タスク内容")
    assignee: str = Field(..., description="担当者")
    due_date: Optional[str] = Field(None, description="期限")

class MinutesOutput(BaseModel):
    """議事録出力データモデル"""
    
    meeting_title: str = Field(..., description="会議タイトル")
    meeting_date: datetime = Field(..., description="会議日時")
    participants: List[str] = Field(..., description="参加者")
    summary: str = Field(..., description="会議要約")
    key_points: List[str] = Field(..., description="主要ポイント")
    decisions: List[str] = Field(..., description="決定事項")
    action_items: List[ActionItem] = Field(..., description="アクションアイテム")
    next_meeting: Optional[str] = Field(None, description="次回会議予定")
    generated_at: datetime = Field(default_factory=datetime.now, description="生成日時")
    
    class Config:
        json_schema_extra = {
            "example": {
                "meeting_title": "週次進捗会議",
                "meeting_date": "2025-01-11T09:00:00",
                "participants": ["田中", "佐藤", "鈴木"],
                "summary": "今週の進捗状況と来週の計画について議論",
                "key_points": ["プロジェクトA進捗80%", "課題Bの解決策検討"],
                "decisions": ["来週までにプロトタイプ完成"],
                "action_items": [
                    {
                        "task": "プロトタイプ作成",
                        "assignee": "田中",
                        "due_date": "2025-01-18"
                    }
                ],
                "next_meeting": "2025-01-18T09:00:00"
            }
        }
```

### 4.4 ビジネスロジック設計

#### 4.4.1 OpenAI クライアント (modules/openai_client.py)

```python
import openai
import logging
from config import settings
from typing import Dict, Any

logger = logging.getLogger(__name__)

class OpenAIClient:
    """OpenAI API クライアント"""
    
    def __init__(self):
        self.client = openai.OpenAI(api_key=settings.openai_api_key)
        
    async def generate_minutes(self, prompt: str) -> str:
        """議事録生成"""
        try:
            response = await self.client.chat.completions.create(
                model=settings.openai_model,
                messages=[
                    {
                        "role": "system",
                        "content": "あなたは会議の議事録作成の専門家です。"
                    },
                    {
                        "role": "user", 
                        "content": prompt
                    }
                ],
                max_tokens=settings.openai_max_tokens,
                temperature=settings.openai_temperature
            )
            
            logger.info("OpenAI API call successful")
            return response.choices[0].message.content
            
        except Exception as e:
            logger.error(f"OpenAI API error: {str(e)}")
            raise
```

#### 4.4.2 議事録生成サービス (modules/minutes_generator.py)

```python
import logging
from typing import Dict, Any
from schemas.transcript import TranscriptInput
from schemas.minutes import MinutesOutput
from modules.openai_client import OpenAIClient
import json

logger = logging.getLogger(__name__)

class MinutesGenerator:
    """議事録生成サービス"""
    
    def __init__(self):
        self.openai_client = OpenAIClient()
        
    def create_prompt(self, transcript_data: TranscriptInput) -> str:
        """プロンプト作成"""
        prompt = f"""
以下の会議トランスクリプトから構造化された議事録を作成してください。

会議情報:
- タイトル: {transcript_data.meeting_title}
- 日時: {transcript_data.meeting_date}
- 参加者: {', '.join(transcript_data.participants)}

トランスクリプト:
{transcript_data.transcript_text}

以下のJSON形式で議事録を作成してください:
{{
    "meeting_title": "会議タイトル",
    "meeting_date": "会議日時",
    "participants": ["参加者リスト"],
    "summary": "会議の要約",
    "key_points": ["主要ポイントのリスト"],
    "decisions": ["決定事項のリスト"],
    "action_items": [
        {{
            "task": "タスク内容",
            "assignee": "担当者",
            "due_date": "期限（YYYY-MM-DD形式、不明な場合はnull）"
        }}
    ],
    "next_meeting": "次回会議予定（不明な場合はnull）"
}}
"""
        return prompt
        
    async def generate_minutes(self, transcript_data: TranscriptInput) -> MinutesOutput:
        """議事録生成メイン処理"""
        try:
            logger.info(f"Starting minutes generation for: {transcript_data.meeting_title}")
            
            # プロンプト作成
            prompt = self.create_prompt(transcript_data)
            
            # OpenAI API呼び出し
            raw_response = await self.openai_client.generate_minutes(prompt)
            
            # JSON解析
            minutes_data = json.loads(raw_response)
            
            # Pydanticモデルに変換
            minutes = MinutesOutput(**minutes_data)
            
            logger.info("Minutes generation completed successfully")
            return minutes
            
        except json.JSONDecodeError as e:
            logger.error(f"JSON parsing error: {str(e)}")
            raise ValueError("Generated response is not valid JSON")
            
        except Exception as e:
            logger.error(f"Minutes generation error: {str(e)}")
            raise
```

### 4.5 APIルーター設計

#### 4.5.1 議事録生成エンドポイント (routers/minutes.py)

```python
from fastapi import APIRouter, HTTPException, Depends
from schemas.transcript import TranscriptInput
from schemas.minutes import MinutesOutput
from modules.minutes_generator import MinutesGenerator
import logging

logger = logging.getLogger(__name__)
router = APIRouter(prefix="/api/v1/minutes", tags=["minutes"])

def get_minutes_generator() -> MinutesGenerator:
    """依存性注入: MinutesGenerator"""
    return MinutesGenerator()

@router.post("/generate", response_model=MinutesOutput)
async def generate_meeting_minutes(
    transcript_data: TranscriptInput,
    generator: MinutesGenerator = Depends(get_minutes_generator)
):
    """
    会議トランスクリプトから議事録を生成
    
    - **meeting_title**: 会議タイトル
    - **meeting_date**: 会議日時
    - **participants**: 参加者リスト
    - **transcript_text**: 会議トランスクリプト
    - **meeting_duration**: 会議時間（分、オプション）
    """
    try:
        logger.info(f"Received minutes generation request: {transcript_data.meeting_title}")
        
        minutes = await generator.generate_minutes(transcript_data)
        
        logger.info("Minutes generation request completed successfully")
        return minutes
        
    except ValueError as e:
        logger.error(f"Validation error: {str(e)}")
        raise HTTPException(status_code=400, detail=str(e))
        
    except Exception as e:
        logger.error(f"Internal server error: {str(e)}")
        raise HTTPException(status_code=500, detail="Internal server error")

@router.get("/health")
async def health_check():
    """ヘルスチェック"""
    return {"status": "healthy", "service": "minutes-generator"}
```

### 4.6 メインアプリケーション (main.py)

```python
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from routers import minutes
from config import settings
import logging

# ログ設定
logging.basicConfig(
    level=getattr(logging, settings.log_level.upper()),
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)

logger = logging.getLogger(__name__)

# FastAPIアプリケーション初期化
app = FastAPI(
    title=settings.app_name,
    version=settings.app_version,
    description="会議トランスクリプトから議事録を自動生成するAPI",
    debug=settings.debug
)

# CORS設定
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # 本番環境では適切に制限
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# ルーター登録
app.include_router(minutes.router)

@app.get("/")
async def root():
    """ルートエンドポイント"""
    return {
        "message": "Meeting Minutes Generator API",
        "version": settings.app_version,
        "docs": "/docs"
    }

@app.get("/health")
async def health():
    """アプリケーションヘルスチェック"""
    return {"status": "healthy"}

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(
        "main:app",
        host=settings.host,
        port=settings.port,
        reload=settings.debug
    )
```

## 5. 実装手順

### 5.1 フェーズ1: 基盤構築
1. プロジェクト構造作成
2. 依存関係インストール
3. 環境変数設定
4. 基本設定ファイル作成

### 5.2 フェーズ2: データモデル実装
1. Pydanticスキーマ定義
2. 入力バリデーション実装
3. 出力フォーマット定義

### 5.3 フェーズ3: ビジネスロジック実装
1. OpenAI クライアント実装
2. プロンプトエンジニアリング
3. 議事録生成ロジック実装
4. エラーハンドリング実装

### 5.4 フェーズ4: API実装
1. FastAPIルーター実装
2. エンドポイント定義
3. 依存性注入設定
4. レスポンス処理実装

### 5.5 フェーズ5: 統合・テスト
1. アプリケーション統合
2. ログ機能テスト
3. API動作確認
4. エラーケーステスト

## 6. ログ設計

### 6.1 ログレベル
- **DEBUG**: 詳細なデバッグ情報
- **INFO**: 一般的な処理情報
- **WARNING**: 警告レベルの問題
- **ERROR**: エラー情報
- **CRITICAL**: 致命的なエラー

### 6.2 ログ出力項目
- タイムスタンプ
- ログレベル
- モジュール名
- メッセージ内容
- リクエストID（トレーサビリティ用）

## 7. セキュリティ考慮事項

### 7.1 API キー管理
- 環境変数での管理
- .envファイルの.gitignore登録
- 本番環境での適切な秘匿化

### 7.2 入力検証
- Pydanticによる厳密なバリデーション
- SQLインジェクション対策
- XSS対策

### 7.3 レート制限
- OpenAI API呼び出し制限
- エンドポイントアクセス制限

## 8. パフォーマンス考慮事項

### 8.1 非同期処理
- FastAPIの非同期機能活用
- OpenAI API呼び出しの非同期化

### 8.2 キャッシュ戦略
- 同一トランスクリプトの結果キャッシュ
- Redis等の外部キャッシュ検討

## 9. 運用・監視

### 9.1 ヘルスチェック
- アプリケーション生存確認
- OpenAI API接続確認

### 9.2 メトリクス
- API呼び出し回数
- レスポンス時間
- エラー率

## 10. 今後の拡張予定

### 10.1 機能拡張
- 複数言語対応
- カスタムテンプレート機能
- 議事録フォーマット選択

### 10.2 技術的改善
- データベース連携
- 認証・認可機能
- マイクロサービス化

---

**作成日**: 2025年1月11日  
**バージョン**: 1.0  
**作成者**: システム開発チーム

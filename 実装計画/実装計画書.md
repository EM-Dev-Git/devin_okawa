# トランスクリプト議事録作成API 実装計画書

## 1. プロジェクト概要

### 1.1 目的
トランスクリプトから議事録を自動生成するFastAPI アプリケーションの実装

### 1.2 主要機能
- **JWT認証システム**: セキュアなユーザー認証
- **ユーザー管理**: データベースによるユーザー情報管理
- **議事録生成**: OpenAI GPT-4を使用したトランスクリプト解析
- **ログ機能**: 包括的なアプリケーションログ
- **環境変数管理**: セキュアな設定管理

## 2. アーキテクチャ設計

### 2.1 ディレクトリ構成
```
transcript_minutes_api/
├── app/
│   ├── __init__.py
│   ├── main.py                 # FastAPIアプリケーション
│   ├── config.py              # 設定管理
│   ├── database.py            # データベース接続
│   ├── models.py              # SQLAlchemyモデル
│   ├── dependencies.py        # 依存性注入
│   ├── routers/               # APIルーター
│   │   ├── __init__.py
│   │   ├── auth.py           # 認証エンドポイント
│   │   ├── users.py          # ユーザー管理
│   │   └── minutes.py        # 議事録生成
│   ├── schemas/               # Pydanticスキーマ
│   │   ├── __init__.py
│   │   ├── auth.py           # 認証スキーマ
│   │   ├── users.py          # ユーザースキーマ
│   │   └── minutes.py        # 議事録スキーマ
│   └── modules/               # ビジネスロジック
│       ├── __init__.py
│       ├── auth.py           # 認証処理
│       ├── transcript_processor.py  # トランスクリプト処理
│       ├── minutes_formatter.py     # 議事録フォーマット
│       └── logger.py         # ログ設定
├── logs/                      # ログファイル
├── .env                       # 環境変数
├── pyproject.toml            # Poetry設定
└── README.md                 # ドキュメント
```

### 2.2 技術スタック
- **FastAPI**: 高性能Webフレームワーク
- **SQLAlchemy**: Python ORM
- **Pydantic**: データバリデーション
- **JWT**: JSON Web Token認証
- **OpenAI API**: GPT-4による自然言語処理
- **SQLite**: 軽量データベース
- **Poetry**: 依存関係管理

## 3. データベース設計

### 3.1 ユーザーテーブル (users)
```sql
CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    hashed_password VARCHAR(255) NOT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 3.2 議事録テーブル (meeting_minutes)
```sql
CREATE TABLE meeting_minutes (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    title VARCHAR(200) NOT NULL,
    transcript TEXT NOT NULL,
    generated_minutes TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users (id)
);
```

## 4. API設計

### 4.1 認証エンドポイント
- `POST /auth/register` - ユーザー登録
- `POST /auth/login` - ログイン（JWTトークン取得）

### 4.2 ユーザー管理エンドポイント
- `GET /users/me` - 現在のユーザー情報取得
- `PUT /users/me` - ユーザー情報更新
- `DELETE /users/me` - ユーザー削除

### 4.3 議事録エンドポイント
- `POST /minutes/generate` - トランスクリプトから議事録生成
- `GET /minutes/` - ユーザーの議事録一覧取得
- `GET /minutes/{id}` - 特定の議事録取得
- `DELETE /minutes/{id}` - 議事録削除

### 4.4 その他
- `GET /` - ルートエンドポイント
- `GET /health` - ヘルスチェック

## 5. セキュリティ設計

### 5.1 認証・認可
- **JWT トークン**: アクセストークンによる認証
- **パスワードハッシュ**: bcryptによる安全なパスワード保存
- **トークン有効期限**: 30分（設定可能）

### 5.2 CORS設定
- 適切なオリジン制限
- 認証情報の安全な送信

## 6. ログ設計

### 6.1 ログレベル
- **DEBUG**: 開発時の詳細情報
- **INFO**: 一般的な動作情報
- **WARNING**: 警告メッセージ
- **ERROR**: エラー情報
- **CRITICAL**: 重大なエラー

### 6.2 ログ出力
- **コンソール出力**: 開発時
- **ファイル出力**: 本番環境
- **ローテーション**: サイズベース（10MB、5ファイル保持）

## 7. 環境変数設計

### 7.1 必須環境変数
```bash
# OpenAI設定
OPENAI_API_KEY=your_openai_api_key_here

# JWT設定
SECRET_KEY=your_super_secret_jwt_key_here
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30

# データベース設定
DATABASE_URL=sqlite:///./meeting_minutes.db

# ログ設定
LOG_LEVEL=INFO
LOG_FILE_PATH=./logs/app.log
LOG_MAX_SIZE=10485760
LOG_BACKUP_COUNT=5
```

## 8. OpenAI統合設計

### 8.1 トランスクリプト処理
- **入力**: 生のトランスクリプトテキスト
- **処理**: GPT-4による構造化解析
- **出力**: 構造化された議事録

### 8.2 プロンプト設計
```
あなたは議事録作成の専門家です。以下のトランスクリプトから、
構造化された議事録を作成してください。

# 出力形式
## 会議概要
- 日時: 
- 参加者: 
- 議題: 

## 主要な議論内容
1. 
2. 
3. 

## 決定事項
- 
- 

## アクションアイテム
- [ ] 担当者: 期限: 内容
- [ ] 担当者: 期限: 内容

## 次回までの課題
- 
- 

# トランスクリプト
{transcript}
```

## 9. 実装手順

### 9.1 フェーズ1: 基盤構築
1. **プロジェクト初期化**
   - Poetry設定
   - 依存関係インストール
   - ディレクトリ構造作成

2. **データベース設定**
   - SQLAlchemyモデル定義
   - データベース接続設定
   - マイグレーション設定

3. **基本設定**
   - 環境変数管理
   - ログ設定
   - FastAPIアプリケーション初期化

### 9.2 フェーズ2: 認証システム
1. **認証モジュール**
   - JWT トークン生成・検証
   - パスワードハッシュ化
   - 認証依存性注入

2. **ユーザー管理**
   - ユーザーモデル
   - ユーザースキーマ
   - ユーザー管理エンドポイント

3. **認証エンドポイント**
   - ユーザー登録
   - ログイン機能

### 9.3 フェーズ3: 議事録生成機能
1. **OpenAI統合**
   - OpenAI クライアント設定
   - トランスクリプト処理モジュール
   - 議事録フォーマッター

2. **議事録管理**
   - 議事録モデル
   - 議事録スキーマ
   - 議事録エンドポイント

3. **ビジネスロジック**
   - トランスクリプト解析
   - 議事録生成
   - データ永続化

### 9.4 フェーズ4: 最終調整
1. **エラーハンドリング**
   - 例外処理
   - エラーレスポンス
   - ログ記録

2. **テスト**
   - 単体テスト
   - 統合テスト
   - API テスト

3. **ドキュメント**
   - API ドキュメント
   - README更新
   - 使用例作成

## 10. 依存関係

### 10.1 主要パッケージ
```toml
[tool.poetry.dependencies]
python = "^3.11"
fastapi = "^0.104.1"
uvicorn = {extras = ["standard"], version = "^0.24.0"}
sqlalchemy = "^2.0.23"
alembic = "^1.12.1"
pydantic = {extras = ["email"], version = "^2.5.0"}
pydantic-settings = "^2.1.0"
python-jose = {extras = ["cryptography"], version = "^3.3.0"}
passlib = {extras = ["bcrypt"], version = "^1.7.4"}
openai = "^1.3.7"
python-multipart = "^0.0.6"

[tool.poetry.group.dev.dependencies]
pytest = "^7.4.3"
pytest-asyncio = "^0.21.1"
httpx = "^0.25.2"
```

## 11. セットアップ手順

### 11.1 開発環境構築
```bash
# 1. 依存関係インストール
poetry install

# 2. 環境変数設定
cp .env.example .env
# .envファイルを編集

# 3. データベース初期化
poetry run alembic upgrade head

# 4. サーバー起動
poetry run uvicorn app.main:app --reload
```

### 11.2 本番環境デプロイ
```bash
# 1. 環境変数設定
export OPENAI_API_KEY="your_key"
export SECRET_KEY="your_secret"

# 2. データベース初期化
poetry run alembic upgrade head

# 3. サーバー起動
poetry run uvicorn app.main:app --host 0.0.0.0 --port 8000
```

## 12. 品質保証

### 12.1 コード品質
- **型ヒント**: 全関数に型注釈
- **ドキュメント**: docstring記述
- **フォーマット**: black, isort使用

### 12.2 テスト戦略
- **単体テスト**: 各モジュールのテスト
- **統合テスト**: API エンドポイントテスト
- **カバレッジ**: 80%以上を目標

### 12.3 セキュリティ
- **入力検証**: Pydanticによる厳密な検証
- **SQL インジェクション**: SQLAlchemy ORM使用
- **XSS対策**: 適切なエスケープ処理

## 13. 運用・保守

### 13.1 監視
- **ヘルスチェック**: `/health` エンドポイント
- **ログ監視**: エラーログの定期確認
- **パフォーマンス**: レスポンス時間監視

### 13.2 バックアップ
- **データベース**: 定期バックアップ
- **ログファイル**: ローテーション設定
- **設定ファイル**: バージョン管理

## 14. 今後の拡張予定

### 14.1 機能拡張
- **ファイルアップロード**: 音声ファイルからの自動転写
- **リアルタイム処理**: WebSocketによるリアルタイム議事録生成
- **多言語対応**: 複数言語での議事録生成

### 14.2 技術的改善
- **キャッシュ**: Redis導入によるパフォーマンス向上
- **非同期処理**: Celeryによるバックグラウンド処理
- **マイクロサービス**: 機能別サービス分割

---

**作成日**: 2025年7月24日  
**バージョン**: 1.0  
**作成者**: AI Assistant

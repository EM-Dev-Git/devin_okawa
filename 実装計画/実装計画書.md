# トランスクリプトから議事録作成API 実装計画書

## 1. プロジェクト概要

### 1.1 目的
音声会議のトランスクリプトから自動的に議事録を生成するFastAPI アプリケーションを開発する。

### 1.2 主要機能
- JWT認証によるユーザー管理
- OpenAI APIを使用したトランスクリプト解析・議事録生成
- データベースによるユーザー・議事録データ管理
- ログ機能
- 環境変数による設定管理

## 2. 技術スタック

### 2.1 フレームワーク・ライブラリ
- **FastAPI**: Webフレームワーク
- **SQLAlchemy**: ORM
- **Alembic**: データベースマイグレーション
- **Pydantic**: データバリデーション
- **python-jose**: JWT認証
- **passlib**: パスワードハッシュ化
- **openai**: OpenAI API クライアント
- **python-multipart**: フォームデータ処理
- **uvicorn**: ASGIサーバー

### 2.2 データベース
- **SQLite**: 開発環境用（本番環境ではPostgreSQL推奨）

### 2.3 外部サービス
- **OpenAI API**: GPT-4を使用したトランスクリプト解析

## 3. ディレクトリ構成

```
transcript_minutes_api/
├── app/
│   ├── __init__.py
│   ├── main.py                 # FastAPIアプリケーション
│   ├── config.py              # 設定管理
│   ├── database.py            # データベース接続
│   ├── models.py              # SQLAlchemyモデル
│   ├── dependencies.py        # 依存性注入
│   ├── routers/               # APIルーター
│   │   ├── __init__.py
│   │   ├── auth.py           # 認証関連エンドポイント
│   │   ├── users.py          # ユーザー管理エンドポイント
│   │   └── minutes.py        # 議事録生成エンドポイント
│   ├── schemas/               # Pydanticスキーマ
│   │   ├── __init__.py
│   │   ├── auth.py           # 認証スキーマ
│   │   ├── users.py          # ユーザースキーマ
│   │   └── minutes.py        # 議事録スキーマ
│   └── modules/               # ビジネスロジック
│       ├── __init__.py
│       ├── auth.py           # 認証処理
│       ├── transcript_processor.py  # トランスクリプト処理
│       ├── minutes_formatter.py     # 議事録フォーマット
│       └── logger.py         # ログ設定
├── logs/                      # ログファイル
├── .env                       # 環境変数
├── pyproject.toml            # Poetry設定
└── README.md                 # プロジェクト説明
```

## 4. データベース設計

### 4.1 Usersテーブル
```sql
CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    hashed_password VARCHAR(255) NOT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 4.2 MeetingMinutesテーブル
```sql
CREATE TABLE meeting_minutes (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    title VARCHAR(200) NOT NULL,
    transcript TEXT NOT NULL,
    generated_minutes TEXT NOT NULL,
    user_id INTEGER NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users (id)
);
```

## 5. API設計

### 5.1 認証エンドポイント
- `POST /auth/register` - ユーザー登録
- `POST /auth/login` - ログイン（JWTトークン発行）
- `POST /auth/refresh` - トークンリフレッシュ

### 5.2 ユーザー管理エンドポイント
- `GET /users/me` - 現在のユーザー情報取得
- `PUT /users/me` - ユーザー情報更新
- `DELETE /users/me` - ユーザー削除

### 5.3 議事録生成エンドポイント
- `POST /minutes/generate` - トランスクリプトから議事録生成
- `GET /minutes/` - ユーザーの議事録一覧取得
- `GET /minutes/{id}` - 特定の議事録取得
- `DELETE /minutes/{id}` - 議事録削除

### 5.4 ヘルスチェック
- `GET /` - ルートエンドポイント
- `GET /health` - ヘルスチェック

## 6. 認証・セキュリティ

### 6.1 JWT認証
- アクセストークンの有効期限: 30分
- リフレッシュトークンの有効期限: 7日
- HS256アルゴリズムを使用

### 6.2 パスワード管理
- bcryptによるパスワードハッシュ化
- 最小8文字、英数字記号を含む複雑なパスワード要求

### 6.3 CORS設定
- 開発環境では全オリジン許可
- 本番環境では特定ドメインのみ許可

## 7. OpenAI統合

### 7.1 トランスクリプト処理フロー
1. ユーザーからトランスクリプトテキストを受信
2. OpenAI GPT-4 APIに送信して解析
3. 構造化された議事録データを生成
4. 日本語フォーマットで整形
5. データベースに保存

### 7.2 プロンプト設計
```
あなたは会議の議事録作成の専門家です。
以下のトランスクリプトから、構造化された議事録を作成してください。

【出力形式】
1. 会議概要
2. 参加者
3. 議題と討議内容
4. 決定事項
5. アクションアイテム
6. 次回予定

【トランスクリプト】
{transcript_text}
```

## 8. ログ設定

### 8.1 ログレベル
- DEBUG: 開発時の詳細情報
- INFO: 一般的な処理情報
- WARNING: 警告レベルの問題
- ERROR: エラー情報
- CRITICAL: 致命的なエラー

### 8.2 ログ出力先
- コンソール出力（開発環境）
- ファイル出力（logs/app.log）
- ローテーション設定（10MB、5ファイル保持）

## 9. 環境変数設定

### 9.1 必須環境変数
```bash
# OpenAI設定
OPENAI_API_KEY=your_openai_api_key_here

# JWT設定
SECRET_KEY=your_super_secret_jwt_key_here
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30

# データベース設定
DATABASE_URL=sqlite:///./meeting_minutes.db

# ログ設定
LOG_LEVEL=INFO
LOG_FILE_PATH=./logs/app.log
LOG_MAX_SIZE=10485760
LOG_BACKUP_COUNT=5
```

## 10. 実装手順

### 10.1 フェーズ1: 基盤構築
1. プロジェクト構造作成
2. 依存関係設定（pyproject.toml）
3. 基本設定ファイル作成（config.py）
4. データベース設定（database.py, models.py）

### 10.2 フェーズ2: 認証システム
1. JWT認証モジュール実装
2. ユーザーモデル・スキーマ作成
3. 認証エンドポイント実装
4. 依存性注入設定

### 10.3 フェーズ3: コアビジネスロジック
1. トランスクリプト処理モジュール
2. OpenAI API統合
3. 議事録フォーマッター
4. ログ設定

### 10.4 フェーズ4: APIエンドポイント
1. ユーザー管理エンドポイント
2. 議事録生成エンドポイント
3. エラーハンドリング
4. バリデーション強化

### 10.5 フェーズ5: 統合・テスト
1. 全機能統合
2. エラーケーステスト
3. パフォーマンステスト
4. ドキュメント作成

## 11. セキュリティ考慮事項

### 11.1 データ保護
- 機密情報の暗号化
- SQLインジェクション対策
- XSS対策
- CSRF対策

### 11.2 API制限
- レート制限実装
- リクエストサイズ制限
- タイムアウト設定

### 11.3 ログセキュリティ
- 機密情報のログ出力禁止
- ログファイルのアクセス制限

## 12. 運用・保守

### 12.1 監視
- アプリケーションヘルスチェック
- エラー率監視
- レスポンス時間監視

### 12.2 バックアップ
- データベースバックアップ
- ログファイルバックアップ

### 12.3 スケーリング
- 水平スケーリング対応
- データベース分離
- キャッシュ戦略

## 13. 今後の拡張予定

### 13.1 機能拡張
- 音声ファイル直接アップロード
- 複数言語対応
- 議事録テンプレート機能
- 会議スケジュール連携

### 13.2 技術的改善
- Redis キャッシュ導入
- PostgreSQL移行
- Docker化
- CI/CD パイプライン構築

---

**作成日**: 2025年7月23日  
**バージョン**: 1.0  
**作成者**: AI Assistant
